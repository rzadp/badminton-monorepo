% !TeX root = ../../main.tex
\newpage
\section{Sieć \textit{Mask R-CNN}}

Sieć \textit{Mask R-CNN} \cite{matterport-mask-rcnn} jest otwartoźródłowym projektem wykorzystującym następujące technologie: \textit{Python3} \cite{python}, \textit{TensorFlow} \cite{tensorflow} oraz \textit{Keras} \cite{keras}.

Konkretne wersje i dodatkowe zależności zawarte są w Dodatku A. Główne komponenty, na które składa się dołączony program to:

\begin{itemize}
  \item Plik \texttt{config.py};
  \item Plik \texttt{model.py};
  \item Plik \texttt{utils.py};
  \item Skrypty do trenowania sieci;
  \item Skrypt do obliczania skuteczności metody.
\end{itemize}

\subsection*{Konfiguracja i hiperparametry modelu}

Konfiguracja i hiperparametry zawarte są w pliku \texttt{config.py}. Umożliwia on konfigurowanie m.in. następujących parametrów:
\begin{itemize}
  \item współczynnika uczenia (z ang. \textit{learning rate}) - parametr wpływający na szybkość uczenia. Strategię doboru tego parametru opisano w Rozdziale \numberref{sec:hiperparametry};
  \item liczba wykorzystywanych kart graficznych - proces uczenia można przyspieszyć wykorzystując wiecej niż jedną kartę graficzną. W ramach niniejszej pracy wykorzystywano jedną kartę graficzną (\textit{GeForce GTX 1080} z 8GB dostępnej pamięci, użyczoną przez firmę \blue{});
  \item liczba klas (w przypadku niniejszej pracy są rozpoznawane dwie klasy, tzn. kort badmintona oraz brak kortu).
\end{itemize}

\subsection*{Klasy i funkcje do stworzenia modelu}
Klasy i funkcje służące do stworzenia modelu \textit{Mask R-CNN} zostały zawarte w pliku \texttt{model.py}. Umożliwiają one wytrenowanie modelu oraz pozwalają na detekcję obszaru kortu na podanych obrazach wejściowych. Klasa modelu pozwala zapisać wytrenowane wagi na dysku, oraz wczytać wagi z pliku.

\subsection*{Plik \texttt{utils.py}}

Plik ten zawiera wiele funkcji pomocniczych, realizujących m.in.:
\begin{itemize}
  \item Wczytanie obrazów z dysku;
  \item Interpretacja anotacji danych;
  \item Zmiana rozdzielczości obrazu;
  \item Pobranie modelu wytrenowanego na zbiorze \textit{COCO} \cite{coco}.
\end{itemize}

\subsection*{Trenowanie sieci}

Trenowania sieci przy użyciu skryptu \texttt{train.sh} polega na uruchamieniu jednego lub więcej treningów, jeden po drugim. Taka seria treningów uruchamiana jest na podstawie zestawu plików opisujących dany trening, czyli precyzujących na jakim zbiorze danych ma zostać przeprowadzony trening, jaki powinien być podział na podzbiory treningowe i walidacyjne wybranego zbioru, oraz czy trenować oryginalną implementację \textit{Mask R-CNN} czy wersję zmodyfikowaną. Skrypt posiada funkcjonalność powiadamiania za pomocą wysyłania poczty elektronicznej - wiadomość wysyłana jest po każdym zakończonym treningu, z informacją czy zakończył się sukcecem lub czy wystąpił błąd.

\subsection*{Skuteczność metody}

Badanie skuteczności metody przeprowadzono przy użyciu skrypty \texttt{validate.sh}, który operuje na rezultatach skryptu \texttt{train.sh} trenującego sieć.
Dla każdego przeprowadzonego treningu, uruchamiany jest wytrenowany model i sprawdzane jest jego działanie na wszystkich podzbiorach z osobna, tzn. na podzbiorach treningowych, walidacyjnych i testowych zbioru \textit{low} i \textit{high}. Na podstawie wyników na zbiorach walidacyjnych i testowych wyliczane są wyniki opisane w~Rozdziale \myrefx{sec:miary}, natomiast wyniki sieci na podzbiorze testowym są zapisywane na dysku jako bazowy obraz z nałożoną przezroczystą maską przewidzianego kortu, na potrzeby ręcznej weryfikacji skuteczności.
